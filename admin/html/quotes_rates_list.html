
<script language="JavaScript">
<!--
document.body.onload=runScripts;
function runScripts(){
	[runScripts]
}

function addCarrier(shipment_id) {
	document.getElementById("carrierform").action="./?action=quotes_rates&id="+shipment_id+"&add";
	document.carrierform.submit();
}
function updateCarrier(id,name,place_holder) {
	var carrier_id = "carrier_id__"+place_holder;
	var place_holder_id = "carrier__"+place_holder;
	document.getElementById(carrier_id).value = id;
	document.getElementById(place_holder_id).innerHTML = name;
}
function carrierFinder(place_holder) {
	window.open("./?action=carrierfinder&place_holder="+place_holder,"carrier_finder","top=0,left=0,width=300,height=400,scrollbars=yes,menu=no,resizable=yes");
}
function confirm_rate_delete(rate_id){
	if(confirm("Are you sure you want to remove this carrier's rate?")){
		document.carrierform.goto.value="./?action=quotes_rates&id=[id]&remove="+rate_id;
		document.carrierform.submit();
	}
}

function calcPercentCharge(rate_id,elem,type,rate,min,max){
	calcTotals(rate_id);
	var percent=eval(rate)/100;
	var total = eval(document.getElementById("total_"+type+"_"+rate_id).innerHTML);
	var temp=dp(total * percent);
	if(temp < eval(min) && eval(min) > 0){temp=eval(min);}
	if(temp > eval(max) && eval(max) > 0){temp=eval(max);}
	document.getElementById(elem).value=temp;
	calcTotals(rate_id);
}

function calcCostPercentageCharge(rate_id,elem1,elem2,rate,min,max){
	calcTotals(rate_id);
	var percent=eval(rate)/100;
	var total = eval(document.getElementById(elem1).value);
	var temp=dp((total * percent)+total);	
	if(temp < eval(min) && eval(min) > 0){temp=eval(min);}
	if(temp > eval(max) && eval(max) > 0){temp=eval(max);}
	document.getElementById(elem2).value=temp;
	calcTotals(rate_id);
}

function calcTotals(rate_id){
	var cost=0;
	var rate=0;
	var profit=0;
	var percent=0;

	var ii = document.carrierform.length;
	for(i=0;i<ii;i++){
		var elem = document.carrierform[i];
		if(elem && elem.name){
            //console.log(elem.name);
			if(elem.name.substring(0,6)=="cost__"){
				var pcs = elem.name.split("__");
				if(pcs && pcs[1]==rate_id){
					val = eval(elem.value);
					cost += (val > 0)?val:0;
				}
			}
			if(elem.name.substring(0,6)=="rate__"){
				var pcs = elem.name.split("__");
				if(pcs && pcs[1]==rate_id){					
					val = eval(elem.value);
					rate += (val > 0)?val:0;
				}
			}
		}
	}

	for(i=0;i<ii;i++){
		var elem = document.carrierform[i];
		if(elem && elem.name){
			if(elem.name.substring(0,6)=="cost__"){
				var pcs = elem.name.split("__");
				if(pcs && pcs[1]==rate_id){
					if(pcs[2]){
						var this_cost=eval(elem.value);
						var this_rate=eval("document.carrierform.rate__"+rate_id+"__"+pcs[2]+".value");

						profit = this_rate-this_cost;
						document.getElementById("profit__"+rate_id+"__"+pcs[2]).innerHTML=dp(profit);
						percent = (this_cost>0)?(profit/this_cost)*100:0;	
						document.getElementById("percent__"+rate_id+"__"+pcs[2]).innerHTML=dp(percent);
					}else{
						var this_cost=eval(elem.value);
						var this_rate=eval("document.carrierform.rate__"+rate_id+".value");

						profit = this_rate-this_cost;
						document.getElementById("profit__"+rate_id).innerHTML=dp(profit);
						percent = (this_cost>0)?(profit/this_cost)*100:0;	
						document.getElementById("percent__"+rate_id).innerHTML=dp(percent);
					}
				}
			}
		}
	}

    /*var container_cost =0;
    document.querySelectorAll('.container_cost').forEach(function(el) {
        container_cost  = parseFloat(container_cost) + parseFloat(el.value)
        console.log("container_cost = "+container_cost);
    });*/

    var container_cost = 0;
    $("#commodityTable .container_cost").each(function(){
        container_cost = $(this).val();
        console.log("contaner ="+container_cost);
    })


	document.getElementById("total_cost_"+rate_id).innerHTML=dp(cost);
	document.getElementById("total_rate_"+rate_id).innerHTML=dp(rate);
	
	profit = rate-cost;
	document.getElementById("total_profit_"+rate_id).innerHTML=dp(profit);
	percent = (cost>0)?(profit/cost)*100:0;
	document.getElementById("total_percent_"+rate_id).innerHTML=dp(percent);
}

function calcRow(rate_id,accessorial_id){
	var url = "?action=quotes_ratesrow&id="+rate_id+"&accessorial_id="+accessorial_id+"&shipment_id=[id]&carrier_id="+document.getElementById("carrier_id__"+rate_id).value+"&customer_id="+window.parent.document.greatform.customer_id.value;
	var xmlhttp;
	if(xmlhttp && xmlhttp.readyState != 0){
		xmlhttp.abort()
	}
	xmlhttp=getXMLHTTP();
	if(xmlhttp){
		xmlhttp.open("GET",url,true);
		xmlhttp.onreadystatechange=function() {
		if(xmlhttp.readyState==4 && xmlhttp.responseText){
            console.log("responseText ="+xmlhttp.responseText);

			eval(xmlhttp.responseText);
		}
	}
	xmlhttp.send(null);
	}
}

function getXMLHTTP(){
  var ret=null;
  try{
	ret=new ActiveXObject("Msxml2.XMLHTTP");
  }catch(e){
	try{
	  ret=new ActiveXObject("Microsoft.XMLHTTP");
	} catch(oc){
	  ret=null;
	}
  }
  if(!ret && typeof XMLHttpRequest != "undefined"){
	ret=new XMLHttpRequest();
  }
  return ret;
}

function round(number,X){X = (!X ? 2 : X);return Math.round(number*Math.pow(10,X))/Math.pow(10,X);}

function dp(price){
	price=round(price);
   string = "" + price;
   number = string.length - string.indexOf('.');
   if (string.indexOf('.') == -1)
      return string + '.00';
   if (number == 1)
      return string + '00';
   if (number == 2)
      return string + '0';
   if (number > 3)
      return string.substring(0,string.length-number+3);
return string;
}

-->
</script>
<form name='carrierform' id='carrierform' action="./?action=quotes_rates&id=[id]" method='POST'>
<input type="hidden" name="goto">
<table border=0>
	<tr>
		<td>
		<table cellpadding="3" cellspacing="1" width="100%">
			<tr>
				<td align='right'><a href='javascript:addCarrier([id])'>+ add rate/carrier</a></td>
			</tr>
		</table>
		[quotes_rates_list_table]
		</td>
	</tr>
	<tr>
		<td align='center'><input type='submit' value='save'></td>
	</tr>
</table>
</form>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
<script>
    $('body').ready(function(){
        $(document).on('change', '.cost_cost', function(){
            var cost =  $(this).val();
            console.log("cost="+cost);
            var container_cost = 0;
            $("#commodityTable tbody .row_commodities").each(function(){
                alert("111");
                //container_cost = $(this).val();
                //console.log("contaner ="+container_cost);
            })

        });
    });

</script>